<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../neon-animation/neon-animations.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<!--
`cbn-help` allows you to use an [ace editor](http://ace.c9.io/) as an element.
### Usage
    <cbn-help>function test() {
     var x = true;
    }</cbn-help>
@element cbn-help
@demo demo/index.html
-->

<dom-module id="cbn-help">
	<style type="text/css" media="screen">
		:host {
			display: block;
		}
	</style>

	<template>
		<paper-button class="account" on-tap="toggleHelp" id="help">
			<iron-icon icon="help"></iron-icon>
		</paper-button>
		<paper-dialog id="dialogHelp" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal style="width: 400px;text-align:left">
			<p class="header-dialog">Help</p>
			<paper-textarea label="Mesaj" style="margin-top:0px" value="{{textHelp}}" max-rows="6"></paper-textarea>
			<div class="buttons">
				<paper-button dialog-dismiss>Anuleaza</paper-button>
				<paper-button dialog-confirm autofocus on-tap="_sendHelp">Trimite</paper-button>
			</div>
		</paper-dialog>
		<iron-ajax id="saveHelp" 
				   loading="{{loading}}" 
				   url="/salveaza/Feedback" 
				   params="{{paramsHelp}}" 
				   on-response="_savedHelp" 
				   handleAs="json" 
				   method="POST"
				   content-type="application/x-www-form-urlencoded"
		></iron-ajax>
	</template>
</dom-module>

<script>
	(function() {
		Polymer({
			is: 'cbn-help',
			properties:{
				loading:{
					type:Boolean,
					value:false,
					notify:true,
					readOnly:true
				}
			},
			ready: function() {
			},
			attached: function() {
			},
			toggleHelp: function () {
				this.$.dialogHelp.open();
			},
			_sendHelp: function () {
				this.$.saveHelp.body = {
					"type": "help",
					"rezolutie": this._calcRezolutie(),
					"content": this.textHelp
				};
				this.$.saveHelp.generateRequest();
			},
			_savedHelp: function () {
				this.fire("cbn-message", {
					type: "success",
					message: "Mesajul a fost salvat."
				});
			},
			_calcRezolutie: function () {
				var screenWidth,
					screenHeight,
					windowWidth,
					windowHeight,
					colorDepth,
					pixelDepth;

				screenWidth = screen.width;
				screenHeight = screen.height;
				windowWidth = window.innerWidth;
				windowHeight = window.innerHeight;
				colorDepth = screen.colorDepth;
				pixelDepth = screen.pixelDepth;
				var rezolutie = "Screen: " + screenWidth + "x" + screenHeight + " ";
				rezolutie += "Window: " + windowWidth + "x" + windowHeight + " ";
				rezolutie += "ColorDepth: " + colorDepth + " ";
				rezolutie += "PixelDepth: " + pixelDepth;
				return rezolutie;
			}
		});
	})();
</script>
